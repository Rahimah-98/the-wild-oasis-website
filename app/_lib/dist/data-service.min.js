"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getCabin=getCabin,exports.getCabinPrice=getCabinPrice,exports.getGuest=getGuest,exports.getBooking=getBooking,exports.getBookings=getBookings,exports.getBookedDatesByCabinId=getBookedDatesByCabinId,exports.getSettings=getSettings,exports.getCountries=getCountries,exports.createGuest=createGuest,exports.createBooking=createBooking,exports.updateGuest=updateGuest,exports.updateBooking=updateBooking,exports.deleteBooking=deleteBooking,exports.getCabins=void 0;var _dateFns=require("date-fns"),_supabase=require("./supabase"),_navigation=require("next/navigation");function getCabin(r){var t,n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(_supabase.supabase.from("cabins").select("*").eq("id",r).single());case 2:return t=e.sent,n=t.data,(a=t.error)&&(console.error(a),(0,_navigation.notFound)()),e.abrupt("return",n);case 7:case"end":return e.stop()}})}function getCabinPrice(r){var t,n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(_supabase.supabase.from("cabins").select("regularPrice, discount").eq("id",r).single());case 2:return t=e.sent,n=t.data,(a=t.error)&&console.error(a),e.abrupt("return",n);case 7:case"end":return e.stop()}})}var getCabins=function(){var r,t,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(_supabase.supabase.from("cabins").select("id, name, maxCapacity, regularPrice, discount, image").order("name"));case 2:if(r=e.sent,t=r.data,n=r.error)throw console.error(n),new Error("Cabins could not be loaded");e.next=8;break;case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}})};function getGuest(r){var t,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(_supabase.supabase.from("guests").select("*").eq("email",r).single());case 2:return t=e.sent,n=t.data,t.error,e.abrupt("return",n);case 6:case"end":return e.stop()}})}function getBooking(r){var t,n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(_supabase.supabase.from("bookings").select("*").eq("id",r).single());case 2:if(t=e.sent,n=t.data,a=t.error,t.count,a)throw console.error(a),new Error("Booking could not get loaded");e.next=9;break;case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}})}function getBookings(r){var t,n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(_supabase.supabase.from("bookings").select("id, created_at, startDate, endDate, numNights, numGuests, totalPrice, guestId, cabinId, cabins(name, image)").eq("guestId",r).order("startDate"));case 2:if(t=e.sent,n=t.data,a=t.error,t.count,a)throw console.error(a),new Error("Bookings could not get loaded");e.next=9;break;case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}})}function getBookedDatesByCabinId(r){var t,n,a,s,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new Date).setUTCHours(0,0,0,0),t=t.toISOString(),e.next=5,regeneratorRuntime.awrap(_supabase.supabase.from("bookings").select("*").eq("cabinId",r).or("startDate.gte.".concat(t,",status.eq.checked-in")));case 5:if(n=e.sent,a=n.data,s=n.error)throw console.error(s),new Error("Bookings could not get loaded");e.next=11;break;case 11:return o=a.map(function(e){return(0,_dateFns.eachDayOfInterval)({start:new Date(e.startDate),end:new Date(e.endDate)})}).flat(),e.abrupt("return",o);case 13:case"end":return e.stop()}})}function getSettings(){var r,t,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(_supabase.supabase.from("settings").select("*").single());case 2:if(r=e.sent,t=r.data,n=r.error)throw console.error(n),new Error("Settings could not be loaded");e.next=8;break;case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}})}function getCountries(){var r,t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(fetch("https://restcountries.com/v2/all?fields=name,flag"));case 3:return r=e.sent,e.next=6,regeneratorRuntime.awrap(r.json());case 6:return t=e.sent,e.abrupt("return",t);case 10:throw e.prev=10,e.t0=e.catch(0),new Error("Could not fetch countries");case 13:case"end":return e.stop()}},null,null,[[0,10]])}function createGuest(r){var t,n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(_supabase.supabase.from("guests").insert([r]));case 2:if(t=e.sent,n=t.data,a=t.error)throw console.error(a),new Error("Guest could not be created");e.next=8;break;case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}})}function createBooking(r){var t,n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(_supabase.supabase.from("bookings").insert([r]).select().single());case 2:if(t=e.sent,n=t.data,a=t.error)throw console.error(a),new Error("Booking could not be created");e.next=8;break;case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}})}function updateGuest(r,t){var n,a,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(_supabase.supabase.from("guests").update(t).eq("id",r).select().single());case 2:if(n=e.sent,a=n.data,s=n.error)throw console.error(s),new Error("Guest could not be updated");e.next=8;break;case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}})}function updateBooking(r,t){var n,a,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(_supabase.supabase.from("bookings").update(t).eq("id",r).select().single());case 2:if(n=e.sent,a=n.data,s=n.error)throw console.error(s),new Error("Booking could not be updated");e.next=8;break;case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}})}function deleteBooking(r){var t,n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(_supabase.supabase.from("bookings").delete().eq("id",r));case 2:if(t=e.sent,n=t.data,a=t.error)throw console.error(a),new Error("Booking could not be deleted");e.next=8;break;case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}})}exports.getCabins=getCabins;
//# sourceMappingURL=data-service.min.js.map
